<!DOCTYPE html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
	<meta name="description" content="">
	<meta name="author" content="">
	<title>Furnace and Fugue: Emblem Music Template</title>
	<link type="text/css" rel="stylesheet" media="screen" href="../assets/css/styles.css" />
</head>
<body class="emblem-body">
	<main id="emblem-data" class="emblem-page" data-id="5" data-page="b">
<!-- EMBLEM GRID -->
		<div class="emblem panel--full">
			<!-- Music -->
			<section id="basic-waypoint__2" class="section__music grid--full">
				<div class="_music music--full">
					<!-- START MUSIC INCLUDE -->
				    <div class="ata-music" data-mei="../data/mei/Fuga 01.xml">
						<div aria-label="musical notation in three voices" class="ata-viz-cmn"></div>
						<div class="ata-viz-audio" data-tempo="56">
							<div class="ata-audio-track" data-pan="-.5" data-gain="1" data-reverb-gain="0.6" 
							    data-mp3="../assets/audio/01-A-56bpm-Dry.mp3" data-reverb-mp3="../assets/audio/01-A-56bpm-Reverb.mp3"></div>
							<div class="ata-audio-track" data-pan="0"   data-gain="1" data-reverb-gain="0.6"  
							    data-mp3="../assets/audio/01-H-56bpm-Dry.mp3" data-reverb-mp3="../assets/audio/01-H-56bpm-Reverb.mp3"></div>
							<div class="ata-audio-track" data-pan=".5"  data-gain="1" data-reverb-gain="0.6"  
							    data-mp3="../assets/audio/01-P-56bpm-Dry.mp3" data-reverb-mp3="../assets/audio/01-P-56bpm-Reverb.mp3"></div>
						</div>
						<div class="ata-viz-pianoroll modal"></div>
				    </div>
				    <!-- END MUSIC INCLUDE -->
    			</div>
			</section>
		</div>
	</main> <!-- END OF EMBLEM PAGE -->
	<div class="_collections"></div>
	<div class="_footer"></div>
<!-- JS -->
	<script src="../assets/js/vendors/jquery/jquery-3.3.1.min.js"></script>
	<script src="../assets/js/vendors/verovio/verovio-toolkit.js"></script>
	<script src="../assets/js/vendors/lity/lity.min.js"></script>
	<script src="../assets/js/stereo-panner-node.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.6/ScrollMagic.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.6/plugins/debug.addIndicators.min.js"></script>
	<script src="../assets/js/emblem.js"></script>
	<script src="../assets/js/notation.js"></script>
	<script>
	$(function () { // NEW STICKY CONTROLS, NEEDS WORK ON REVERSE SCROLL
		let myMusic;
		let myControls;
		setTimeout(function() {
			createScrollingScene();
		}, 1500);
		function createScrollingScene() {
			console.log("I AM IN THE STICKY FUNCTION");
			myMusic = document.querySelector(".section__music");
			myControls = document.querySelector(".ata-music > .transport");
			// console.log(myMusic);
			// console.log(myControls);
			const controller = new ScrollMagic.Controller();
			const scene = new ScrollMagic.Scene({
				offset: -100,
				triggerElement: myMusic,
				triggerHook: 0,
				duration: getScrollingDuration(),
				reverse: true
			}).addTo(controller);
			scene.on("start", function(e) {
				console.log("music controls are supposed to stay sticky when scrolling down");
				$(myControls).addClass('is-stuck');
			});
			scene.on("leave", function(e) {
				console.log("music controls are supposed to unstick when scrolling to the end of the notation");
				$(myControls).removeClass('is-stuck');
			});
		}
		function getScrollingDuration() {
			let myDuration = (myMusic.offsetHeight - myControls.offsetHeight) * 1.2;
			console.log(myDuration + " is my sticky scrolling duration / approx. px height of the music-page notation SVG");
			return myDuration;
		}
	});
	</script>
</body>
</html>